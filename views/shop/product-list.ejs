<%- include('../includes/head.ejs') %>
<link rel="stylesheet" href="/css/product.css">
</head>

<body>
<%- include('../includes/navigation.ejs') %>

<main>
  <!-- Category Filter -->
  <div class="filter-section">
    <div class="filter-container">
      <h3 style="color: #333; margin-bottom: 1rem;">Filter by Category</h3>
      <div class="filter-buttons">
        <a href="/products" class="filter-btn <%= !selectedCategory ? 'active' : '' %>">
          All Categories
        </a>
        <% if(categories && categories.length > 0) { %>
          <% categories.forEach(cat => { %>
            <a href="/products?category=<%= cat %>" class="filter-btn <%= selectedCategory === cat ? 'active' : '' %>">
              <%= cat %>
            </a>
          <% }); %>
        <% } %>
      </div>
    </div>
  </div>

  <% if (products.length > 0) { %>
    <div class="products">
      <% for (let product of products) { %>
        <article class="product-item">
          <div class="product-item__image">
            <img src="<%= product.imageUrl %>" alt="<%= product.title %>">
            <% if(!product.inStock) { %>
              <div class="out-of-stock">Out of Stock</div>
            <% } %>
          </div>
          <div class="product-item__content">
            <div class="product-item__category"><%= product.category %></div>
            <h2 class="product-item__title"><%= product.title %></h2>
            <p class="product-item__description"><%= product.description %></p>
            <% if(product.rating) { %>
              <div class="product-item__rating">
                ‚≠ê <%= product.rating %> (<%= Math.floor(product.rating * 10) %> reviews)
              </div>
            <% } %>
            <div class="product-item__price">$<%= product.price %></div>
            <div class="product-item__actions">
              <%- include('../includes/details.ejs', {product}) %>
              <% if(isAuthenticated && product.inStock) { %>
                <%- include('../includes/add-to-cart.ejs', {product}) %>
              <% } else if(!isAuthenticated) { %>
                <a href="/login" class="btn btn-secondary">View Details</a>
              <% } %>
            </div>
          </div>
        </article>
      <% } %>
    </div>
    <%- include('../includes/pagination.ejs') %>
  <% } else { %>
    <div style="text-align: center; padding: 3rem; background: white; border-radius: 12px;">
      <h1 style="color: #666;">No Products Found</h1>
      <p style="color: #999; margin-bottom: 2rem;">Try selecting a different category or browsing all products</p>
      <a href="/products" class="btn btn-primary">View All Products</a>
    </div>
  <% } %>
</main>

<%- include('../includes/end.ejs') %>
